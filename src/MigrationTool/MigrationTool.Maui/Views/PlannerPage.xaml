<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:MigrationTool.Maui.ViewModels"
             x:Class="MigrationTool.Maui.Views.PlannerPage"
             x:DataType="vm:PlannerViewModel"
             Title="{Binding Title}">

    <Grid RowDefinitions="Auto,*,Auto" Padding="20">

        <!-- Toolbar -->
        <HorizontalStackLayout Grid.Row="0" Spacing="10" Margin="0,0,0,20">
            <Button Text="New Plan" Command="{Binding NewPlanCommand}"/>
            <Button Text="Load" Command="{Binding LoadPlanCommand}"/>
            <Button Text="Save" Command="{Binding SavePlanCommand}" IsEnabled="{Binding HasPlan}"/>
            <Button Text="Validate" Command="{Binding ValidatePlanCommand}" IsEnabled="{Binding HasPlan}"/>
            <Button Text="Execute" 
                    Command="{Binding ExecutePlanCommand}" 
                    IsEnabled="{Binding HasPlan}"
                    BackgroundColor="{StaticResource Primary}"/>
        </HorizontalStackLayout>

        <!-- Steps List -->
        <Frame Grid.Row="1" Padding="10">
            <Grid RowDefinitions="Auto,*">
                
                <!-- Steps Header -->
                <Grid Grid.Row="0" ColumnDefinitions="50,*,*,150,50" Padding="10" BackgroundColor="{StaticResource Gray200}">
                    <Label Grid.Column="0" Text="#" FontAttributes="Bold"/>
                    <Label Grid.Column="1" Text="Source" FontAttributes="Bold"/>
                    <Label Grid.Column="2" Text="Target" FontAttributes="Bold"/>
                    <Label Grid.Column="3" Text="Action" FontAttributes="Bold"/>
                    <Label Grid.Column="4" Text="" FontAttributes="Bold"/>
                </Grid>

                <!-- Steps -->
                <CollectionView Grid.Row="1" 
                               ItemsSource="{Binding Steps}"
                               SelectionMode="Single"
                               SelectedItem="{Binding SelectedStep}">
                    <CollectionView.EmptyView>
                        <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center" Padding="40">
                            <Label Text="ðŸ“‹" FontSize="48" HorizontalOptions="Center"/>
                            <Label Text="No migration steps" FontSize="16" HorizontalOptions="Center"/>
                            <Label Text="Click 'New Plan' to create a migration plan" 
                                   FontSize="12" 
                                   TextColor="{StaticResource Gray500}"
                                   HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </CollectionView.EmptyView>
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="x:Object">
                            <Grid ColumnDefinitions="50,*,*,150,50" Padding="10" BackgroundColor="{StaticResource Gray50}">
                                <Label Grid.Column="0" Text="{Binding Index}" VerticalOptions="Center"/>
                                <Entry Grid.Column="1" Text="{Binding Source}" Placeholder="Source path"/>
                                <Entry Grid.Column="2" Text="{Binding Target}" Placeholder="Target path"/>
                                <Picker Grid.Column="3" SelectedItem="{Binding Action}">
                                    <Picker.ItemsSource>
                                        <x:Array Type="{x:Type x:String}">
                                            <x:String>Move File</x:String>
                                            <x:String>Move Folder</x:String>
                                            <x:String>Copy File</x:String>
                                            <x:String>Copy Folder</x:String>
                                            <x:String>Rename Namespace</x:String>
                                        </x:Array>
                                    </Picker.ItemsSource>
                                </Picker>
                                <Button Grid.Column="4" Text="ðŸ—‘" 
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:PlannerViewModel}}, Path=RemoveStepCommand}"
                                        CommandParameter="{Binding .}"
                                        WidthRequest="40"/>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </Grid>
        </Frame>

        <!-- Add Step Button -->
        <Button Grid.Row="2" 
                Text="+ Add Step" 
                Command="{Binding AddStepCommand}"
                IsEnabled="{Binding HasPlan}"
                HorizontalOptions="Start"
                Margin="0,10,0,0"/>

    </Grid>

</ContentPage>
